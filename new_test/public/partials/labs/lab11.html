<div class = "row" ng-controller = 'OverviewController'>
  <div class="small-12 medium-12 large-8 large-centered columns">
    <h1>Et tu, Brute?</h1>
    <!-- <h2>DO NOT START LAB UNLESS TOLD TO DO SO! (WE MIGHT CHANGE THE SPECS)</h2> -->
    <ul class="toc">
      <h4>Contents</h4>
      <a href="#lab11/#objectives">Learning Objectives</a>
      <a href="#lab11/#setup">Setup</a>
      <a href="#lab11/#backstory">Backstory</a>
      <a href="#lab11/#files">Files</a>
      <a href="#lab11/#usage">Usage</a>
      <a href="#lab11/#error">Error</a>
      <a href="#lab11/#mission">Mission</a>
      <a href="#lab11/#grading">Grading</a>
    </ul>

    <!-- Learning Objectives -->
    <div class = "pad">
      <div id = "objectives" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Learning Objectives</h2>
        </div>
        <div class = "content">
          <ul>
              <li>File Descriptors</li>
              <li>Pipes</li>
              <li>Forking with Pipes (IPC)</li>
              <li>Reading and Writing from Pipes</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Setup -->
    <div class = "pad">
      <div id = "setup" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Setup</h2>
        </div>
        <div class = "content">
          <br/>
          First update svn
          <pre class = "terminal">
cd ~/cs241
svn up
cd et_tu_brute</pre>
        </div>
      </div>
    </div>

    <!-- Backstory -->
    <div class = "pad">
      <div id = "backstory" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Backstory</h2>
        </div>
        <div class = "content">
            <p>
                You are an intern for Marcus Junius Brutus.
            </p>
            <p>
                Brutus is planning the assassination of Julius Caesar, dictator of the Roman Senate.
                In order to do so he must know the exact whereabouts of Caesar and when he will be most vunerable.
                A visitor who claims to be from the future gives you a <del>file</del> journal that has all of this information.
                The visitor has encrypted the journal to avoid the information from falling into the wrong hands.
                He warns brutus to read it with discretion.
                The journal is encrypted with a <a href = "https://en.wikipedia.org/wiki/Caesar_cipher">caesar cipher</a>,
                which has a well known solution for <a href = "https://en.wikipedia.org/wiki/Caesar_cipher#Breaking_the_cipher">decrypting</a>.
                Your fellow interns are already aware of this decryption method, so you do not need to worry about it.
            </p>
            <p>
                There is a catch.
                Caesar is well aware of this decryption method, so he encrypts every line of the journal with an arbitary shift amount.
                To make matters worse, your fellow <del>slaves</del> interns who are brute forcing all the possible ciphers take long naps
                and the journal only documents Caesar's wherabouts for the next couple of days.
                This means time is of the essence.
                So in order to decrypt the journal in time, Brutus has asked you to assign each line of the journal to an intern to decrypt.
                At the end you will stitch all their work together and write it to a new journal for brutus to read.
                Simple right?
                Except that some lines are longer than others,
                you need to wait for all the interns to finish,
                and you need to write it all back in order for it to make sense to Brutus.
            </p>
            <p>

            </p>
        </div>
      </div>
    </div>

    <!-- Provided -->
    <div class = "pad">
      <div id = "files" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Files</h2>
        </div>
        <div class = "content">
            <ul>
                You'll be given:
                <li>
                    cipher.h - header file for the decryption libarary.
                </li>
                <li>
                    cipher.o - object file for the decryption libarary.
                    The source is not here, since the other interns will not give it to you.
                </li>
                <li>
                    Makefile - the makefile you should use to build.
                </li>
                <li>
                    journal.txt - a newline separated journal that you must decrypt.
                    We will keep the lines under 4096 bytes (default size of a pipe).
                </li>
                <li>
                    brutus_reference - reference executable which you should use for comparing your solution with.
                </li>
            </ul>
            <br/>
            <ul>
                You can modify:
                <li>
                    brutus.c - main file which will contain your implementation for brute forcing caesar ciphers.
                </li>
            </ul>
        </div>
      </div>
    </div>

    <!-- Usage -->
    <div class = "pad">
      <div id = "usage" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Usage</h2>
        </div>
        <div class = "content">
<pre class="terminal">
./brutus &lt;input_file_path&gt; &lt;output_file_path&gt;
</pre>
        </div>
      </div>
    </div>

    <!-- Error cases -->
    <div class = "pad">
      <div id = "error" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Error Cases</h2>
        </div>
        <div class = "content">
            <ul>
                Error cases:
                <li>
                    If run without an input and output file your program should print an error
                    message describing the arguments it expects and exit with error code 1.
                </li>
            </ul>
        </div>
      </div>
    </div>

    <!-- Mission -->
    <div class = "pad">
      <div id = "mission" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Mission</h2>
        </div>
        <div class = "content">
            <ul>
                The mission will have the following parts
                <li>
                    <h3>Parse the arguments</h3>
                    <p>
                        Your program needs to take 2 arguments.
                        The path for the input file that you need to read from and the path to the output file that you need to write the decryptions to.
                        Note that the input file will always be newline separated and each line will be at most 4096 bytes.
                    </p>
                </li>
                <li>
                    <h3>Make 1 pipe (read and write end) and store 1 pid for each child</h3>
                    <p>
                        Whether you figure out how many lines the file has before you do the computations is up to you.
                        The advantages and disadvantages are things that you will have to consider in your implementation.
                        You need at one pipe per child, since you need a read end for the parent and a write end for the child.
                    </p>
                </li>
                <li>
                    <h3>Assign 1 line to each child process to decrypt</h3>
                    <p>
                        This is where the magic happens.
                        Remember that when forking with pipes,
                        it is common practice to close the unnecessary (unused) end of each pipe in the child and parent process.
                        This is to avoid the awkward scenario where a process is listening to itself.
                        You need to find some way for the parent process to give the line to decrypt to its child.
                        One somewhat hacky solution is to have the parent read the line from the file then fork.
                        The child now has its own copy of the line.
                        Once the child has the line to decrypt, you should have it call on the
                        <pre class = "terminal">char * get_most_likely_print_out(char * line)</pre>
                        function from cipher.o.
                        Once your child is done decrypting a line,
                        it should write into the write end of its pipe so that the parent can later read from it.
                        If a child has no more use then it should close all remaining ends to its pipe and exit.
                    </p>
                </li>
                <li>
                    <h3>Collect the decryptions</h3>
                    <p>
                        Like any responsible parent your parent process should wait on its children.
                        This is where having remembered your childrens' pids come in handy.
                        Once you are done waiting for all your children to finish
                        you can start reading from your pipes sequentially.
                    </p>
                </li>
                <li>
                    <h3>Write all the decryptions to a file</h3>
                    <p>
                        Now that you have all your children's print outs you can write them to the output file
                        in the same order as the lines in the original file.
                        You should write exactly what you read from your children and not a single byte more.
                    </p>
                </li>
            </ul>

        </div>
      </div>
    </div>

    <!-- Grading -->
    <div class = "pad">
      <div id = "grading" class="mdl-card mdl-shadow--2dp large-card">
        <div class="mdl-card__title" style = "background-color: #03a9f4">
          <h2 class="mdl-card__title-text" style = "color: white">Grading</h2>
        </div>
        <div class = "content">
            Your grade will be some linear combination of having a correct solution and attending lab.
        </div>
      </div>
    </div>
  </div>
</div>
